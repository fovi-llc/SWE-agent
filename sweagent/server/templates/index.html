<!DOCTYPE html>
<html>
<head>
    <title>Run Command</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/mainpage.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script src="{{ url_for('static',filename='scripts/mainscript.js') }}"></script>
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#dataForm').on('submit', function(event) {
                event.preventDefault();
                removeAllMessagesFromFeed("#agentFeed");
                removeAllMessagesFromFeed("#envFeed");
                const dataPath = $('#data_path').val();
                const testRun = $('#test_run').is(':checked');
                $.get(`/run`, { data_path: dataPath, test_run: testRun }, function(response) {
                    $('#responseMessage').text(response);
                }).fail(function(error) {
                    console.error('Error:', error);
                });
            });

            // Hovering over a message in the feed highlights the corresponding step
            // and scrolls to the right place
            $(document).on('mouseenter', '[class*=step]', function() {
                // Extract the step number from the class name
                const stepNumber = $(this).attr('class').match(/step(\d+)/)[1];
                if (stepNumber) {
                    highlightStep(stepNumber);

                    if ($(this).closest('.envFeed').length > 0) {
                        console.log("In agent feed");
                        scrollToFirstMessageForStep("agentFeed", stepNumber);
                    }
                    else {
                        console.log("In env feed");
                        scrollToFirstMessageForStep("envFeed", stepNumber);
                    }
                }
            });
        });
    </script>
</head>
<body>
    <h1>Start run</h1>
    <form id="dataForm">
        <label for="data_path">Data Path:</label>
        <input type="text" id="data_path" name="data_path" value="https://github.com/klieret/swe-agent-test-repo/issues/1" required>
        <label for="test_run">Test run (no LM queries)</label>
        <input type="checkbox" id="test_run" name="test_run" checked>
        <button type="submit">Run</button>
    </form>
    <div id="responseMessage"></div>
    <div id="update"></div>
    <h2>Trajectory</h2>
    <div id="container">
        <div id="agentFeed" class="agentFeed">
            <h3>Agent Feed</h3>
        </div>
        <div id="envFeed" class="envFeed">
            <h3>Environment Feed</h3>
        </div>
    </div>
</body>
</html>
